"use strict";window.admintools=window.admintools||{},"undefined"==typeof admintools.Controlpanel&&(admintools.Controlpanel={modal:null,graph:{from:"",to:"",exceptPoints:[],subsPoints:[],typePoints:[]},plots:[null,null],myIP:"",showChangelog:function(){},cleanTmp:function(){},fixPerms:function(){},tmpLogCheck:function(){},optimizeDB:function(){},closeModal:function(){}}),admintools.Controlpanel.closeModal=function(){admintools.Controlpanel.modal&&(admintools.Controlpanel.modal.hide(),admintools.Controlpanel.modal=null)},admintools.Controlpanel.iframeDialog=function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"400",d=document.getElementById("admintools-dialog"),e=document.getElementById("admintools-dialog-header"),f=document.getElementById("admintools-dialog-body"),g=document.createElement("iframe");g.setAttribute("src",a),g.setAttribute("width","100%"),g.setAttribute("height",c),g.setAttribute("frameborder",0),g.setAttribute("allowtransparency","true"),f.innerHTML="",f.appendChild(g),e.innerHTML="",e.style.display="none",b&&(e.innerHTML=b,e.style.display=null),admintools.Controlpanel.modal=new bootstrap.Modal(d,{keyboard:!1,backdrop:"static"}),admintools.Controlpanel.modal.show()},admintools.Controlpanel.fixPerms=function(a){return a.preventDefault(),admintools.Controlpanel.iframeDialog(document.getElementById("fixperms").href,null,"400"),!1},admintools.Controlpanel.cleanTmp=function(a){return a.preventDefault(),admintools.Controlpanel.iframeDialog(document.getElementById("cleantmp").href,null,"400"),!1},admintools.Controlpanel.tmpLogCheck=function(a){return a.preventDefault(),admintools.Controlpanel.iframeDialog(document.getElementById("tmplogcheck").href,null,"400"),!1},admintools.Controlpanel.optimizeDB=function(a){return a.preventDefault(),admintools.Controlpanel.iframeDialog(document.getElementById("optimizedb").href,null,"400"),!1},admintools.Controlpanel.loadGraphs=function(){function a(a,b){return Array(Math.max(b-(a+"").length+1,0)).join(0)+a}admintools.Controlpanel.graph.from=document.getElementById("admintools_graph_datepicker").value;var b=new Date(admintools.Controlpanel.graph.from);b=new Date(b.getTime()+2592000000),b=new Date(a(b.getUTCFullYear(),4)+"-"+a(b.getUTCMonth()+1,2)+"-"+a(b.getUTCDate(),2)),admintools.Controlpanel.graph.to=b.toISOString().slice(0,10),admintools.Controlpanel.graph.lineLabels=[],admintools.Controlpanel.graph.pieLabels=[],admintools.Controlpanel.graph.exceptPoints=[],admintools.Controlpanel.graph.typePoints=[],document.getElementById("admintoolsExceptionsPieChart").style.display="none",document.getElementById("akthrobber2").style.display=null,document.getElementById("admintoolsExceptionsLineChart").style.display="none",document.getElementById("akthrobber").style.display=null,admintools.Controlpanel.loadBlockedRequestsGraph(),admintools.Controlpanel.loadExceptionsPieGraph()},admintools.Controlpanel.loadBlockedRequestsGraph=function(){var a="index.php?option=com_admintools&view=Blockedrequestslog&datefrom=".concat(admintools.Controlpanel.graph.from,"&dateto=").concat(admintools.Controlpanel.graph.to,"&groupbydate=1&reason=&ip=&savestate=0&format=json&limit=0&limitstart=0");Joomla.request({url:a,method:"GET",perform:!0,onSuccess:function(a){var b=JSON.parse(a),c={},d=new Date(admintools.Controlpanel.graph.from),e="";admintools.Controlpanel.graph.lineLabels=[],admintools.Controlpanel.graph.exceptPoints=[];for(var f=function a(){function b(a){return 9>=a?"0"+a:a}return e===admintools.Controlpanel.graph.to?1:void(e=d.getFullYear()+"-"+b(d.getMonth()+1)+"-"+b(d.getDate()),c[e]=0,d=new Date(d.getTime()+864e5))};!f(););for(var g,h=0;h<b.length;h++)g=b[h],c[g.date]=parseInt(100*g.exceptions)/100;for(var j in c)c.hasOwnProperty(j)&&(admintools.Controlpanel.graph.lineLabels.push(j),admintools.Controlpanel.graph.exceptPoints.push(c[j]));0===b.length&&(admintools.Controlpanel.graph.lineLabels=[],admintools.Controlpanel.graph.exceptPoints=[]),document.getElementById("akthrobber").style.display="none";var k=document.getElementById("admintoolsExceptionsLineChart"),l=document.getElementById("admintoolsExceptionsLineChartNoData");return k.style.display=null,l.style.display="none",0===admintools.Controlpanel.graph.exceptPoints.length?(k.style.display="none",void(l.style.display=null)):void admintools.Controlpanel.renderBlockedRequestsGraph()}})},admintools.Controlpanel.loadExceptionsPieGraph=function(){var a="index.php?option=com_admintools&view=Blockedrequestslog&datefrom="+admintools.Controlpanel.graph.from+"&dateto="+admintools.Controlpanel.graph.to+"&groupbydate=0&groupbytype=1&reason=&ip=&savestate=0&format=json&limit=0&limitstart=0";Joomla.request({url:a,method:"GET",perform:!0,onSuccess:function b(a){var c=JSON.parse(a);admintools.Controlpanel.graph.pieLabels=[],admintools.Controlpanel.graph.typePoints=[];for(var d,e=0;e<c.length;e++)d=c[e],admintools.Controlpanel.graph.pieLabels.push(d.reason),admintools.Controlpanel.graph.typePoints.push(parseInt(100*d.exceptions)/100);document.getElementById("akthrobber2").style.display="none";var f=document.getElementById("admintoolsExceptionsPieChart"),g=document.getElementById("admintoolsExceptionsPieChartNoData");f.style.display=null,g.style.display="none",0===admintools.Controlpanel.graph.typePoints.length?(f.style.display="none",g.style.display=null):admintools.Controlpanel.renderExceptionsPieGraph()}})},admintools.Controlpanel.renderBlockedRequestsGraph=function(){var a;null===(a=admintools.Controlpanel.plots[0])||void 0===a||a.destroy(),admintools.Controlpanel.plots[0]=new Chart(document.getElementById("admintoolsExceptionsLineChart"),{type:"line",data:{labels:admintools.Controlpanel.graph.lineLabels,datasets:[{data:admintools.Controlpanel.graph.exceptPoints,fill:!0,borderColor:"#4BC0C0",backgroundColor:"rgb(81,79,80, 0.15)",tension:.1}]},options:{plugins:{legend:{display:!1}},scales:{x:{type:"time",time:{unit:"day"}},y:{ticks:{beginAtZero:!0}}}}})},admintools.Controlpanel.renderExceptionsPieGraph=function(){var a;null===(a=admintools.Controlpanel.plots[1])||void 0===a||a.destroy(),admintools.Controlpanel.plots[1]=new Chart(document.getElementById("admintoolsExceptionsPieChart"),{type:"doughnut",data:{labels:admintools.Controlpanel.graph.pieLabels,datasets:[{backgroundColor:["#40B5B8","#E2363C","#514F50","#92CF3B","#F0AD4E","#EFEFEF","yellow","green","purple"],data:admintools.Controlpanel.graph.typePoints,fill:!1,borderColor:"rgb(75, 192, 192)",lineTension:.1}]},options:{plugins:{legend:{position:"right"}}}})},admintools.Controlpanel.warnBeforePurgingSessions=function(a){if(!confirm(Joomla.JText._("COM_ADMINTOOLS_DATABASETOOLS_LBL_PURGESESSIONS_WARN")))return a.preventDefault(),!1},admintools.Controlpanel.showUnblockMyself=function(){var a=Joomla.getOptions("admintools.Controlpanel.isPro");if(a){var b=Joomla.getOptions("admintools.Controlpanel.myIP"),c=Math.random().toString(16).substr(2,14);Joomla.request({url:"index.php?option=com_admintools&view=Controlpanel&task=selfblocked&tmpl=component&_cacheBustingJunk=".concat(c),method:"GET",perform:!0,onSuccess:function c(a){var d,e=JSON.parse(a);if(null!==e&&void 0!==e&&e.blocked){var f=document.getElementById("selfBlocked");if(f){var g=document.querySelectorAll("#selfBlocked > a"),h="A"===(null===(d=f[0])||void 0===d?void 0:d.tagName);if(!(1>g.length)||h){var i=g[0];i.href=i.href+"&ip="+b,f.style.display="block"}}}}})}},window.addEventListener("DOMContentLoaded",function(){var a,b,c,d,e;null===(a=document.getElementById("cleantmp"))||void 0===a||a.addEventListener("click",admintools.Controlpanel.cleanTmp),null===(b=document.getElementById("fixperms"))||void 0===b||b.addEventListener("click",admintools.Controlpanel.fixPerms),null===(c=document.getElementById("tmplogcheck"))||void 0===c||c.addEventListener("click",admintools.Controlpanel.tmpLogCheck),null===(d=document.getElementById("optimizedb"))||void 0===d||d.addEventListener("click",admintools.Controlpanel.optimizeDB),null===(e=document.getElementById("purgesessions"))||void 0===e||e.addEventListener("click",admintools.Controlpanel.warnBeforePurgingSessions),admintools.Controlpanel.showUnblockMyself();var f=0!==Joomla.getOptions("admintools.Controlpanel.graphs",1);f&&(admintools.Controlpanel.loadGraphs(),document.getElementById("admintools_graph_reload").addEventListener("click",admintools.Controlpanel.loadGraphs))});
//# sourceMappingURL=ControlPanel.min.js.map