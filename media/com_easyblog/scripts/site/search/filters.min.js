EasyBlog.module("site/search/filters",function(t){var a=this;EasyBlog.require().done(function(i){EasyBlog.Controller("Search.Filters",{defaultOptions:{activeCategoryId:0,"{searchForm}":"[data-eb-search-form]","{searchInput}":"[data-eb-search-input]","{activeTitle}":"[data-category-title]","{catNavItem}":"[data-category-nav]","{catNavBack}":"[data-category-back]","{catFilterItem}":"[data-eb-filter]","{inputCatId}":"[data-category-id]","{activeCatTitle}":"[data-category-title]","{categoryContainer}":"[data-eb-category-container]","{categoryGroup}":"[data-eb-category-group]","{inputTagIds}":"[data-tag-ids]","{tagContainer}":"[data-eb-tags-container]","{tagClearBtn}":"[data-eb-tags-clear]","{tagFilterItem}":"[data-eb-tags-filter]","{tagCounter}":"[data-eb-tags-count]","{sortItem}":"[data-sort-filter]","{sortTitle}":"[data-sort-title]","{sortInput}":"[data-sort-input]","{sortContainer}":"[data-sort-container]","{orderItem}":"[data-order-filter]","{orderTitle}":"[data-order-title]","{orderInput}":"[data-order-input]","{orderContainer}":"[data-order-container]"}},function(n,r){return{init:function(){n.isLoading=!1,n.updateActiveTags(),n.initSorting()},updateActiveCategory:function(t,a){n.activeCatTitle().html(a),n.inputCatId().val(t)},hideParents:function(t){t.siblings().addClass("t-d--none")},hideSiblingsAndSelf:function(t){t.addClass("t-d--none"),t.siblings().addClass("t-d--none")},loading:function(){n.categoryGroup().addClass("t-d--none"),n.categoryContainer().addClass("is-loading")},doneLoading:function(){n.categoryGroup().removeClass("t-d--none"),n.categoryContainer().removeClass("is-loading")},searchLoading:function(){n.element.addClass("is-loading")},searchDoneLoading:function(){n.wrapper().removeClass("is-loading")},updateActiveTags:function(){var e=[],t=n.tagContainer().find("[data-eb-tags-filter].is-active");i.each(t,function(t,a){e.push(i(a).data("id"))}),n.tagCounter().text(e.length),n.tagCounter().closest("a").removeClass("t-border--primary"),0<e.length&&n.tagCounter().closest("a").addClass("t-border--primary"),n.inputTagIds().val(e.join(","))},initSorting:function(){var t=n.sortInput().val(),a=n.orderInput().val();!t||0<(t=n.sortContainer().find('[data-sort-filter="'+t+'"]')).length&&n.activateSorting(t),a&&n.updateOrdering(a)},activateSorting:function(t){var a=t.closest("li"),e=t.data("sort-filter"),t=t.attr("title");a.addClass("active"),n.sortTitle().text(t),n.sortInput().val(e)},activateOrdering:function(t){var a=t.closest("li"),e=t.data("order-filter"),t=t.attr("title");a.addClass("active"),n.orderTitle().text(t),n.orderInput().val(e)},updateOrdering:function(t){t=n.orderContainer().find('[data-order-filter="'+t+'"]');0<t.length&&(n.orderContainer().find("li").removeClass("active"),n.activateOrdering(t))},hideResultsContent:function(){i("[data-eb-search-content]").addClass("t-hidden")},submitSearchForm:function(){n.isLoading||(n.isLoading=!0,n.searchLoading(),n.hideResultsContent(),n.searchForm().submit())},"{orderItem} click":function(t,a){t=i(t);n.orderContainer().find("li").removeClass("active"),n.activateOrdering(t),0<i("[data-eb-search-content]").length&&!n.isLoading&&n.submitSearchForm()},"{sortItem} click":function(t,a){var e=i(t),t=e.data("sort-filter");n.sortContainer().find("li").removeClass("active"),n.activateSorting(e),""==n.orderInput().val()&&n.updateOrdering("asc"),"hits"==t&&n.updateOrdering("desc"),0<i("[data-eb-search-content]").length&&!n.isLoading&&n.submitSearchForm()},"{tagClearBtn} click":function(){var t=0<n.searchInput().val().length,a=0<n.inputTagIds().val().length;t&&a||(event.preventDefault(),event.stopPropagation()),n.tagFilterItem().removeClass("is-active"),n.updateActiveTags(),t&&a&&n.submitSearchForm()},"{tagFilterItem} click":function(t,a){var e=0<n.searchInput().val().length;e||(a.preventDefault(),a.stopPropagation());t=i(t);t.hasClass("is-active")?t.removeClass("is-active"):t.addClass("is-active"),n.updateActiveTags(),e&&n.submitSearchForm()},"{catNavBack} click":function(t,a){a.preventDefault(),a.stopPropagation();var e=i(t).parent("ul");e.addClass("t-d--none");a=e.parent("[data-category-filter]"),t=a.data("category-filter");r.activeCategoryId&&t==r.activeCategoryId&&a.addClass("active"),a.parent().removeClass("has-submenu"),e.siblings().removeClass("t-d--none"),a.removeClass("t-d--none"),a.siblings().removeClass("t-d--none")},"{catFilterItem} click":function(t,a){var e=i(t),r=e.data("id"),t=i.trim(e.text());n.updateActiveCategory(r,t),i("[data-category-filter]").removeClass("active"),e.parent("[data-category-filter]").addClass("active"),0<n.searchInput().val().length&&n.submitSearchForm()},"{catNavItem} click":function(t,a){a.preventDefault(),a.stopPropagation();var e=i(t),r=e.parent("[data-category-filter]"),a=r.data("category-filter");e.parents("[data-eb-category-container]").find("[data-eb-category-group]").addClass("has-submenu"),r.removeClass("active"),n.hideParents(r),n.hideSiblingsAndSelf(e);t=r.parent("[data-category-nested]");0<t.length&&t.addClass("has-submenu");t=e.siblings("[data-category-nested]");if(0<t.length)return n.hideParents(e),n.hideSiblingsAndSelf(e),void t.removeClass("t-d--none");n.loading(),EasyBlog.ajax("site/views/categories/getCategoriesForFilters",{parentId:a,activeId:n.inputCatId().val()}).done(function(t){n.hideParents(e),n.hideSiblingsAndSelf(e),r.append(t)}).always(function(){n.doneLoading()})}}}),a.resolve()})});