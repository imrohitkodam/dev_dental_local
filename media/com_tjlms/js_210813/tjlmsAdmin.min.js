var tjlmsAdmin={calculateCourseUrl:"index.php?option=com_tjlms&view=tools&task=tools.calculateCourseProgress&format=json",showEnrolledUsersUrl:"index.php?option=com_tjlms&task=course.enrolledUsersCount&format=json",fileViewerUrl:"index.php?option=com_tjlms&view=tools&task=tools.migrateCourseMedia&format=json",fileCountUrl:"index.php?option=com_tjlms&task=course.courseMediaCount&format=json",validateDates:function(e){var a=jQuery(e).find('input[name="jform[start_date]"]'),s=jQuery(e).find('input[name="jform[end_date]"]'),t=a.val(),o=s.val();if(""!=t){if(null==t.split(" ")[0].match(/^\d{4}[-](0?[1-9]|1[012])[-](0?[1-9]|[12][0-9]|3[01])$/))return Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_INVALID_START_DATE")]}),!1}else if(""!=o){if(null==(o=o.split(" "))[0].match(/^\d{4}[-](0?[1-9]|1[012])[-](0?[1-9]|[12][0-9]|3[01])$/))return Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_INVALID_END_DATE")]}),!1}return!(""!=o&&t>o)||(jQuery(s).focus(),Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_DATE_RANGE_VALIDATION")]}),!1)},eachform:{$form:null,saveurl:"",extraValidations:"",validate:function(){var e=document.formvalidator.isValid(this.$form),a=this.$form;if(e&&this.extraValidations){var s=!0,t=this.extraValidations.split(",");jQuery(t).each(function(e,t){var o=window,r=t.split(".");for(i=0;i<r.length;i++)o=o[r[i]];if(!(s=o(a)))return!1}),s||(e=!1)}return e},ajaxsave:function(){var e=this.validate();if(e){this.saveurl||(this.saveurl=jQuery(this.$form).attr("action")),this.saveurl=Joomla.getOptions("system.paths").base+"/"+this.saveurl;var a=this.$form,s={};if("multipart/form-data"==jQuery(a).attr("enctype")){var t=new FormData(a[0]);s.contentType=!1,s.processData=!1}else t=a.serialize();tjService.postData(this.saveurl,t,s).fail(function(a){e=!1}).done(function(s){if(!s.success&&s.message){var t={error:[s.message]};Joomla.renderMessages(t),e=!1}s.messages&&Joomla.renderMessages(s.messages),"multipart/form-data"==jQuery(a).attr("enctype")&&jQuery(a).find("input[type='file']").val(""),e=s.data})}return e}},stepform:{ajaxSaveTabs:!0,ifintmpl:!0,init:function(){ifintmpl=this.ifintmpl;var e=this;jQuery(document).ready(function(){ifintmpl&&jQuery('a[data-toggle="tab"]').on("shown.bs.tab",function(a){e.formactions()}),e.formactions()}),jQuery(window).load(function(){jQuery(".nav-tabs li").click(function(){var a=jQuery(this).index();if(!e.validateTabs(a))return!1}),jQuery("[data-js-attr='form-actions-next']").click(function(){jQuery(".nav-tabs li.active").next().find("a").trigger("click"),jQuery("html, body").animate({scrollTop:0},500)}),jQuery("[data-js-attr='form-actions-prev']").click(function(){jQuery(".nav-tabs li.active").prev().find("a").trigger("click")})})},formactions:function(){jQuery("#toolbar-prev button, #toolbar-next button, #toolbar-apply button, #toolbar-save button","[data-js-attr='form-actions']").hide(),jQuery(".nav-tabs li.active").is(":first-child")?(jQuery("#toolbar-prev button","[data-js-attr='form-actions']").hide().addClass("hide"),jQuery("#toolbar-next button","[data-js-attr='form-actions']").show().removeClass("hide")):jQuery(".nav-tabs li.active").is(":last-child")?(jQuery("#toolbar-prev button","[data-js-attr='form-actions']").show().removeClass("hide"),jQuery("#toolbar-next button","[data-js-attr='form-actions']").hide().addClass("hide"),jQuery("#toolbar-save button","[data-js-attr='form-actions']").show().removeClass("hide")):(jQuery("#toolbar-prev button","[data-js-attr='form-actions']").show().removeClass("hide"),jQuery("#toolbar-next button","[data-js-attr='form-actions']").show().removeClass("hide")),jQuery("[data-js-id='item-id']").val()&&jQuery("#toolbar-save","[data-js-attr='form-actions']").show()},validateTabs:function(e){for(var a=!0,s=tjlmsAdmin.eachform,t=0;t<e;t++){var o=jQuery(".nav-tabs li").get(t),r=jQuery("a",jQuery(o)).attr("href");if(s.extraValidations=jQuery(".extra_validations",jQuery(r)).attr("data-js-validation-functions"),this.ajaxSaveTabs){s.$form=jQuery("form",r);var i=jQuery("form [name='task']",r).val(),n=jQuery("form [name='option']",r).val();s.saveurl="index.php?option="+n+"&task="+i+"&format=json",a=s.ajaxsave()}else s.$form=jQuery(r),a=s.validate();if(!a)break;this.ajaxSaveTabs&&jQuery.each(a,function(e,a){jQuery("[data-js-id='"+e+"']").val(a)});var l=jQuery(s.$form).attr("id");window.tjlmsAdmin[l]&&window.tjlmsAdmin[l].afterSave&&window.tjlmsAdmin[l].afterSave(a)}return a}},modules:{init:function(){var e=this;jQuery(window).load(function(){jQuery(".tjlms_module__changestate, .tjlms_module__edit, .tjlms_module__delete").show(),jQuery(".tjlms_lesson__edit, .tjlms_lesson__delete").show(),jQuery(".content-li").click(function(){var e=jQuery(this).closest("li").attr("id").replace("modlist_","");jQuery("#curriculum-lesson-ul_"+e).toggle()}),jQuery(document).on("click","[data-js-id='course-module'] [data-js-id='change-module-state']",function(){var a=jQuery(this).closest("[data-js-id='course-module']"),s=jQuery(a).attr("data-js-itemid"),t=jQuery(a).find('[data-js-id="module-state"]').val(),o=1===parseInt(t)?0:1;e.changeModuleState(s,o)}),jQuery(document).on("click","[data-js-id='edit-module']",function(){var a=jQuery(this).closest("[data-js-id='course-module']").attr("data-js-itemid");e.toggleForm(a,"show")}),jQuery(document).on("click","[data-js-id='delete-module']",function(){var a=jQuery(this).closest("[data-js-id='course-module']");if(jQuery(a).find('[data-js-id="module-lesson"]').length>0)return alert(Joomla.JText._("COM_TJLMS_MODUELS_MODULE_WITH_LESSONS_DELETE_ERROR")),!1;var s=jQuery(a).attr("data-js-itemid");e.deleteModule(s)}),jQuery(document).on("click","[data-js-id='delete-lesson']",function(){var a=jQuery(this).closest("[data-js-id='module-lesson']").attr("data-js-itemid"),s=jQuery(this).closest("[data-js-id='course-module']").attr("data-js-itemid"),t=jQuery("#course_id").val();e.deleteLesson(a,s,t)}),e.updateModules(),e.sort()})},sort:function(){jQuery("[data-js-id='lessons_container']").sortable({scroll:!1,connectWith:"[data-js-id='lessons_container']",handle:".lessonSortingHandler",items:"> li:not(.non-sortable-lesson-li)",update:function(){var e=jQuery("#course_id",jQuery(this).closest(".curriculum-container")).val(),a=jQuery(this).closest("[data-js-id='course-module']"),s=jQuery(a).attr("data-js-itemid"),t=[];jQuery(a).find('[data-js-id="module-lesson"]').each(function(e){t[e]=jQuery(this).attr("data-js-itemid"),e++});var o={courseId:e,moduleId:s,lessons:t};tjService.postData("index.php?option=com_tjlms&task=modules.sortModuleLessons&format=json",o).fail(function(e){var a={error:[e]};Joomla.renderMessages(a)}).done(function(e){if(!e.success&&e.message){var a={error:[e.message]};Joomla.renderMessages(a)}tjlmsAdmin.modules.updateModules()})}}),jQuery(".courseModules").sortable({handle:".moduleSortingHandler",update:function(){var e=jQuery("#course_id",jQuery(this).closest(".curriculum-container")).val(),a=[];jQuery("[data-js-id='course-module']").each(function(e){a[e]=jQuery(this).attr("data-js-itemid"),e++});var s={courseId:e,modules:a};tjService.postData("index.php?option=com_tjlms&task=modules.sortModules&format=json",s).fail(function(e){var a={error:[e]};Joomla.renderMessages(a)}).done(function(e){if(!e.success&&e.message){var a={error:[e.message]};Joomla.renderMessages(a)}})}})},updateModules:function(){jQuery('[data-js-id="course-module"]',window.parent.document).each(function(){var e=jQuery(this).find('[data-js-id="module-lesson"]').length;jQuery(this).find(".tjlms_module__delete").hide(),0==e&&jQuery(this).find(".tjlms_module__delete").show()})},changeModuleState:function(e,a,s){var t={mod_id:e,state:a};tjService.postData("index.php?option=com_tjlms&task=modules.changeState&format=json",t).fail(function(e){var a={error:[e]};Joomla.renderMessages(a)}).done(function(s){if(!s.success&&s.message){var t={error:[s.message]};Joomla.renderMessages(t)}if(s.message){t={success:[s.message]};Joomla.renderMessages(t)}var o=a?"publish":"unpublish",r=a?"modPublish":"modUnpublish";s.data.state;jQuery("#modlist_"+e+" .tjlms_module").removeClass("modUnpublish").removeClass("modPublish").addClass(r),jQuery("#modlist_"+e+" .tjlms_module .tjlms_module__changestate i").removeClass("icon-publish").removeClass("icon-unpublish").addClass("icon-"+o),jQuery("#modlist_"+e+' .tjlms_module [data-js-id="module-state"]').val(a)})},deleteModule:function(e){if(1==confirm(Joomla.JText._("COM_TJLMS_SURE_DELETE_MODULE"))){var a={};a[jQuery('[data-js-id="form-token"]').attr("name")]=1,a.moduleId=e,tjService.postData("index.php?option=com_tjlms&task=modules.deleteModule&format=json",a).fail(function(e){var a={error:[e]};Joomla.renderMessages(a)}).done(function(a){if(!a.success&&a.message){var s={error:[a.message]};Joomla.renderMessages(s)}if(a.success){s={success:[a.message]};Joomla.renderMessages(s),jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").remove()}})}return!1},editModule:function(e){var a=new FormData;let s=jQuery("#module-image"+e)[0].files[0],t=jQuery("#course_id").val(),o=jQuery("#module-description"+e).val(),r=jQuery("#module-title"+e).val(),i=jQuery("#state"+e).val();a.append("jform[image]",s),a.append("tjlms_module[id]",e),a.append("tjlms_module[description]",o),a.append("tjlms_module[name]",r),a.append("tjlms_module[course_id]",t),a.append("tjlms_module[state]",i),params={},params.contentType=!1,params.processData=!1,url="index.php?option=com_tjlms&task=modules.saveModule&format=json",tjService.postData(url,a,params).fail(function(e){var a={error:[e.message]};Joomla.renderMessages(a)}).done(function(a){0==e&&location.reload(!0);var s=jQuery("#tjlms_module_form_"+e).find(".module-title").val();if(jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").find(".tjlms_module_title").text(s),jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").find(".tjlms_module_thumbnail_image").val(a.data.image),a.data.imagePath&&(jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").find(".tjlms_module_thumbail").removeClass("hide"),jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").find(".tjlms_module_image_path").attr("src",a.data.imagePath)),tjlmsAdmin.modules.toggleForm(e,"hide"),jQuery("#module-image"+e).val(""),a.success){var t={success:[a.message]};Joomla.renderMessages(t)}else{var o={error:[a.message]};Joomla.renderMessages(o)}})},toggleModuleAdditionalInfo:function(e){if(0===e)var a=jQuery("[data-js-id='create-module-form']");else a=jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']");!0===a.find(".tjlms_module_image_desc").is(":hidden")?a.find(".toggleModuleButton").html("<a>"+Joomla.JText._("COM_TJLMS_ADDITIONAL_DETAILS_HIDE")+"</a>"):a.find(".toggleModuleButton").html("<a>"+Joomla.JText._("COM_TJLMS_ADDITIONAL_DETAILS")+"</a>"),a.find(".tjlms_module_image_desc").toggle("open")},deleteMedia:function(e){if(!confirm(Joomla.JText._("JGLOBAL_CONFIRM_DELETE")))return!1;data={moduleId:e},url="index.php?option=com_tjlms&task=modules.deleteImage&format=json",tjService.postData(url,data).fail(function(e){var a={error:[e]};Joomla.renderMessages(a)}).done(function(a){if(jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").find(".tjlms_module_thumbnail_image").val(""),jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").find(".tjlms_module_thumbail").addClass("hide"),jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']").find(".tjlms_module_image_path").attr("src",""),a.success){var s={success:[a.message]};Joomla.renderMessages(s)}else{var t={error:[a.message]};Joomla.renderMessages(t)}})},toggleForm:function(e,a="show"){var s=jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']");return"show"==a?s.length?(jQuery(s).find("[data-js-id='edit-module-form']").show(),jQuery(s).find("[data-js-id='edit-module-form'] .module-title").focus()):(jQuery('[data-js-id="create-module-form"]').show(),jQuery(".add-module-div").hide(),jQuery('[data-js-id="create-module-form"] .module-title').focus()):s.length?jQuery(s).find("[data-js-id='edit-module-form']").hide():(jQuery('[data-js-id="create-module-form"]').hide(),jQuery(".add-module-div").show()),!1},deleteLesson:function(e,a,s){if(1==confirm(Joomla.JText._("COM_TJLMS_SURE_DELETE"))){var t={};t[jQuery('[data-js-id="form-token"]').attr("name")]=1,t.lessonId=e,t.moduleId=a,t.courseId=s,tjService.postData("index.php?option=com_tjlms&task=modules.deleteLesson&format=json",t).fail(function(e){var a={error:[e]};Joomla.renderMessages(a)}).done(function(a){if(!a.success&&a.message){var s={error:[a.message]};Joomla.renderMessages(s)}if(a.success){s={success:[a.message]};Joomla.renderMessages(s),jQuery("#lessonlist_"+e).remove()}})}return!1}},lesson:{init:function(e,a,s,t,o){jQuery("input[type='file'][data-upload-ajax='1']").change(function(){thisfile=jQuery(this);var e=jQuery(thisfile)[0].files[0],a=new FormData;a.append("FileInput",e);var t=jQuery('[data-js-id="id"]').val(),o=jQuery('[data-js-id="format"]').val(),r=jQuery('[data-js-id="subformat"]').val();a.append("mediaformat",o),a.append("subformat",r),a.append("formatData["+o+"]["+r+"][lessonId]",t),tjLmsCommon.file.$file=thisfile,tjLmsCommon.file.formData=a,tjLmsCommon.file.allowedSize=s,tjLmsCommon.file.showstatusbar=!0,tjLmsCommon.file.afterProcessDone="tjlmsAdmin.lessonFormatForm.populateMediaId";tjLmsCommon.file.upload()}),jQuery(document).ready(function(){o>0&&(jQuery("#assessmentform .subform-repeatable").addClass("disabled").css("pointer-events","none"),jQuery("[data-js-id='disable-if-reviewed']").addClass("disabled").css("pointer-events","none"))}),Joomla.submitbutton=function(e){if("lesson.save"==e){var a=jQuery(".tjlms_add_lesson_form .nav-tabs li").length;if(!tjlmsAdmin.stepform.validateTabs(a))return!1}window.location=t}},preview:function(e){var a=root_url+"index.php?option=com_tjlms&view=lesson&tmpl=component&lesson_id="+e+"&mode=preview&isAdmin=1",s=jQuery(window).width(),t=jQuery(window).height();SqueezeBox.open(a,{handler:"iframe",closable:!1,size:{x:s,y:t},sizeLoading:{x:s,y:t},classWindow:"tjlms_lesson_screen",classOverlay:"tjlms_lesson_screen_overlay"})},selectionPopup:function(){jQuery("#lessonTypeModal").modal("show")}},basicForm:{validate:function(e){var a=jQuery(e).find("[name$='[no_of_attempts]']"),s=jQuery(e).find("[name$='[no_of_attempts]']").val(),t=jQuery(e).find("#no_attempts").val(),o=jQuery(e).find("#max_attempt").val();if(isNaN(s)&&jQuery(a).val(0),0!=s&&s<o){var r=Joomla.JText._("COM_TJLMS_MAX_ATTEMPT_VALIDATION_MSG").replace("%s",o);return Joomla.renderMessages({error:[r]}),jQuery(a).val(t).focus(),!1}return!0}},lessonFormatForm:{$form:null,initForm:function(){return this.$form=jQuery(".lesson-format-form")},showSubformat:function(e,a){jQuery(this.$form).find(".subformat").hide().addClass("hide"),jQuery(this.$form).find("."+e+"_subformat[data-subformat='"+a+"']").show().removeClass("hide")},validate:function(formElement){var format=jQuery(formElement).find("[name$='[format]']").val(),subformat=jQuery(formElement).find("[name$='[subformat]']").val(),media_id=jQuery(formElement).find("[name$='[media_id]']").val(),formId=jQuery(formElement).find("[name$='[form_id]']").val(),function_to_call="validate"+format+subformat,check_validation=eval(function_to_call)(formId,format,subformat,media_id);return"0"!=check_validation.check||(Joomla.renderMessages({error:[check_validation.message]}),!1)},populateMediaId:function(e){jQuery("[data-js-id='media_id']").val(e.media_id)}},associateFileForm:{$form:null,initForm:function(){return this.$form=jQuery(".lesson-format-form")},init:function(){jQuery("[data-js-type='associate_file_upload'] input[type='file']").change(function(){thisfile=jQuery(this);var e=jQuery(thisfile)[0].files[0],a=new FormData;a.append("FileInput",e);var s=jQuery('[data-js-id="id"]').val();a.append("mediaformat","associate"),a.append("subformat","upload"),a.append("formatData[associate][upload][lessonId]",s),tjLmsCommon.file.$file=thisfile,tjLmsCommon.file.formData=a,parseFloat(thisfile.attr("data-allowedsize"))&&(tjLmsCommon.file.allowedSize=parseFloat(thisfile.attr("data-allowedsize"))),tjLmsCommon.file.showstatusbar=!0,tjLmsCommon.file.afterProcessDone="tjlmsAdmin.associateFileForm.showFileinAssociatelist";tjLmsCommon.file.upload()}),jQuery(document).on("click","[data-js-id='associated-file-remove']",function(){var e=jQuery(this).attr("data-js-val"),a=jQuery(this).closest(".lesson-associatefile-form").find("[data-js-id='id']").val();tjlmsAdmin.associateFileForm.removeFile(a,e)})},showFileinAssociatelist:function(e){var a=jQuery("[data-js-id='id']").val(),s=jQuery(".lesson-associatefile-form"),t='<tr id="assocfiletr_'+e.media_id+'"><td class="tjlmscenter" id="list_select_files'+e.media_id+'"><span>'+e.org_filename+'</span><input type="hidden" name="lesson_files[][media_id]" value="'+e.media_id+'"/></td><td class="tjlmscenter"><i id="removeFile'+e.media_id+'" onclick="tjlmsAdmin.associateFileForm.removeFile(\''+a+"', '"+e.media_id+'\')" class="remove btn">×</i></td></tr>';jQuery(s).find(".no_selected_files").hide(),jQuery(s).find("#list_selected_files").append(t),jQuery(s).find("#list_selected_files").show()},batchSelect:function(e){var a=jQuery("input[id*='cb']:checked").length;if(0==a)return alert(Joomla.JText._("COM_TJLMS_ASSOCIATE_MESSAGE_SELECT_ITEMS")),!1;window.parent.jQuery('.lesson-associatefile-form[data-js-unique="'+e+'"] .no_selected_files').hide(),window.parent.jQuery("#lesson-associatefile-form_"+e+" #list_selected_files").show();var s=window.parent.jQuery('.lesson-associatefile-form[data-js-unique="'+e+'"]').find("[data-js-id='id']").val(),t=1;jQuery("input[id*='cb']:checked").each(function(){var o=jQuery(this).val(),r=jQuery(this).closest(".associtefile").find(".associtefile__name").text(),i=Joomla.getOptions("system.paths").root+"/index.php?option=com_tjlms&task=lessonform.addMediaAsAssociatetoLesson&format=json",n={mediaId:o,lessonId:s},l=tjService.postData(i,n);l.fail(function(e){var a={error:[e]};Joomla.renderMessages(a),!1}).done(function(s){if(!s.success&&s.message){var i={error:[s.message]};Joomla.renderMessages(i),!1}s.messages&&Joomla.renderMessages(s.messages);var n='<tr id="assocfiletr_'+o+'" data-js-id="associated-file"><td class="tjlmscenter" id="list_select_files'+o+'"><span>'+r+'</span><input type="hidden" name="lesson_files[][media_id]" value="'+o+'"/></td><td class="tjlmscenter"><i data-js-id="associated-file-remove" data-js-val="'+o+'" class="remove btn">×</i></td></tr>';jQuery("#lesson-associatefile-form_"+e+" #list_selected_files",parent.document).append(n),t==a&&parent.SqueezeBox.close(),t++})})},removeFile:function(e,a){if(1==confirm(Joomla.JText._("COM_TJLMS_REMOVE_ASSOCIATE_FILE_MESSAGE"))){var s=Joomla.getOptions("system.paths").root+"/index.php?option=com_tjlms&task=lessonform.removeAssociatedFileFromLesson&format=json",t={mediaId:a,lessonId:e},o=tjService.postData(s,t);o.fail(function(e){var a={error:[e]};Joomla.renderMessages(a),!1}).done(function(e){if(!e.success&&e.message){var s={error:[e.message]};Joomla.renderMessages(s),!1}if(e.message){s={success:[e.message]};Joomla.renderMessages(s),jQuery("#assocfiletr_"+a).remove()}})}}},assessmentform:{$form:null,init:function(){jQuery(document).on("subform-row-add",function(e,a){jQuery(a).find(".param_value").attr("onBlur","tjlmsAdmin.assessmentform.calculateTotal()"),jQuery(a).find(".param_weightage").attr("onBlur","tjlmsAdmin.assessmentform.calculateTotal()")}),jQuery(".param_weightage, .param_value").blur(function(){tjlmsAdmin.assessmentform.calculateTotal()}),jQuery("[name='jform[add_assessment]']").click(function(){1==jQuery(this).val()?(jQuery("[data-js-id='assessment-details']").show().removeClass("hide"),jQuery(".assessment-param-required").addClass("required").attr("required","required")):(jQuery("[data-js-id='assessment-details']").hide().addClass("hide"),jQuery(".assessment-param-required").removeClass("required").removeAttr("required"))}),jQuery("[data-js-id='assessment-details']").hide().addClass("hide"),jQuery(".assessment-param-required").removeClass("required").removeAttr("required"),1==jQuery("[name='jform[add_assessment]']:checked").val()&&(jQuery("[data-js-id='assessment-details']").show().removeClass("hide"),jQuery(".assessment-param-required").addClass("required").attr("required","required")),jQuery("[name='jform[assessment_answersheet]']").click(function(){1==jQuery(this).val()?jQuery("[data-js-id='answersheet_options']").show().removeClass("hide"):jQuery("[data-js-id='answersheet_options']").hide().addClass("hide")}),jQuery("[data-js-id='answersheet_options']").hide().addClass("hide"),1==jQuery("[name='jform[assessment_answersheet]']:checked").val()&&jQuery("[data-js-id='answersheet_options']").show().removeClass("hide")},initForm:function(){return this.$form=jQuery("#assessmentform")},calculateTotal:function(){var e=0,a=this.$form;jQuery(".subform-repeatable-group",a).each(function(){e+=jQuery(".param_value",this).val()*jQuery(".param_weightage",this).val()}),jQuery("#jform_total_marks",a).val(e)},validate:function(e){if(1==jQuery(e).find("[name='jform[add_assessment]']:checked").val()){if(0==jQuery(".subform-repeatable-group",e).length)return Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_ASSESSMENT_MSG_NO_PARAMS")]}),!1;tjlmsAdmin.assessmentform.calculateTotal();var a=parseInt(jQuery("#jform_total_marks",e).val()),s=parseInt(jQuery("#jform_passing_marks",e).val());if(isNaN(s)||s<=0||s>a)return jQuery("input[name='jform[passing_marks]']",e).val(""),jQuery("input[name='jform[passing_marks]']",e).focus(),Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_ASSESSMENT_MARKS_MISMATCH")]}),!1;var t=jQuery(e).find("[name$='[assessment_attempts]']"),o=jQuery(e).find("[name$='[assessment_attempts]']").val(),r=jQuery(e).find("#no_assessment").val(),i=jQuery(e).find("#max_assessment").val();if(isNaN(o)&&jQuery(t).val(0),0!==o&&o<i){var n=Joomla.JText._("COM_TJLMS_MIN_NO_OF_ASSESSMENT_VALIDATION_MSG").replace("%s",i);return Joomla.renderMessages({error:[n]}),jQuery(t).val(r).focus(),!1}}else jQuery("input[name='jform[passing_marks]']",e).val(""),jQuery("input[name='jform[total_marks]']",e).val("");return!0}},initialize:function(){var e=this;return jQuery(window).load(function(){if(e.lessonFormatForm.initForm().length){var a=jQuery(e.lessonFormatForm.$form).find("input[name$='[format]']").val();jQuery("[name$='[subformat]']").change(function(){e.lessonFormatForm.showSubformat(a,jQuery(this).val())})}e.associateFileForm.initForm().length&&e.associateFileForm.init(),e.assessmentform.initForm().length&&e.assessmentform.init()}),this},certificateTemplate:{editor:"",usedCertCount:"",init:function(){var e=this.usedCertCount;jQuery(document).ready(function(){jQuery("#jformcertificatetemplate").change(function(e){tjlmsAdmin.certificateTemplate.loadTemplate()}),e>0&&(jQuery("#jform_access0").attr("disabled",!0),jQuery("#jform_access").parent(".controls").append("<div class='alert alert-info'>"+Joomla.JText._("COM_TJLMS_CERTIFICATE_ACCESS_MSG")+"</div>")),Joomla.submitbutton=function(e){"certificatetemplate.cancel"==e?Joomla.submitform(e,document.getElementById("certificatetemplate-form")):"certificatetemplate.cancel"!=e&&document.formvalidator.isValid(document.id("certificatetemplate-form"))&&Joomla.submitform(e,document.getElementById("certificatetemplate-form"))}})},loadTemplate:function(){var e=Joomla.getOptions("system.paths").base+"/index.php?option=com_tjlms&task=certificatetemplate.loadtemplate",a={id:jQuery("#jformcertificatetemplate").val()};tjService.postData(e,a).fail(function(e){var a={error:[e.responseText]};Joomla.renderMessages(a)}).done(function(e){if(!e.success&&e.message){var a={error:[e.message]};Joomla.renderMessages(a)}else"tinymce"==this.editor||"jce"==this.editor?jQuery("iframe").contents().find("body#tinymce").html(e.data.body):jQuery("iframe").contents().find("body").html(e.data.body),jQuery("#jform_body").val(e.data.body),jQuery("#jform_template_css").val(e.data.template_css),"tinymce"!=this.editor&&"jce"!=this.editor||(tinyMCE.execCommand("mceToggleEditor",!1,"response.data.body"),tinyMCE.execCommand("mceToggleEditor",!1,"response.data.body"))})}},tools:{startLimit:0,init:function(){jQuery(window).load(function(){var e=jQuery("#filter_course_names").val();e&&tjlmsAdmin.tools.showEnrolledUsers(e)})},calculateProgress:function(e,a){var s=jQuery("#filter_course_names").val(),t=jQuery("#course_id").val();if(e&&a){var o=Joomla.JText._("COM_TJLMS_TOOLS_COMPLETED_SUCCESSFULLY");tjlmsAdmin.tools.uploadProgressBar(a,o)}else tjlmsAdmin.tools.startLimit=0;""!=s&&tjlmsAdmin.tools.sendAjaxRequest(tjlmsAdmin.calculateCourseUrl,s,tjlmsAdmin.tools.startLimit),""!=t&&tjlmsAdmin.tools.sendAjaxRequest(tjlmsAdmin.fileViewerUrl,t,tjlmsAdmin.tools.startLimit)},sendAjaxRequest:function(e,a,s){jQuery.ajax({url:e,data:{courseId:a,batchsize:batchsize,startLimit:s},type:"POST",success:function(e){var a=JSON.parse(e),s=a.data;a.success?s.flag&&tjlmsAdmin.tools.calculateProgress(s.flag,s.totalCount):Joomla.renderMessages({error:[a.message]})},error:function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_CALCULATE_COURSE_PROGRESS_FAILURE")]})}})},showEnrolledUsers:function(e){jQuery.ajax({url:tjlmsAdmin.showEnrolledUsersUrl,type:"POST",data:{cid:e},success:function(a){var s=JSON.parse(a);e&&s.data>0?(jQuery("#enrolled_user_notice").show().html(Joomla.JText._("COM_TJLMS_CALCULATE_COURSE_TRACK_ENROLLED_USER_COUNT").replace("%s",s.data)),jQuery("#recalculate").removeClass("inactiveLink"),jQuery("#recalculate").removeClass("disabled")):(jQuery("#enrolled_user_notice").hide(),jQuery("#recalculate").addClass("inactiveLink"),jQuery("#recalculate").addClass("disabled"))}})},uploadProgressBar:function(e,a){jQuery(".progressbar").removeClass("hide"),tjlmsAdmin.tools.startLimit=parseInt(tjlmsAdmin.tools.startLimit)+parseInt(batchsize);var s=Math.round(100*tjlmsAdmin.tools.startLimit/e);batchsize>e&&(s=100),jQuery(".progressbar").html('<div class="center alert alert-info"><strong>'+Joomla.JText._("COM_TJLMS_TOOLS_PROGRESS_MESSAGE")+'</strong></div><div class="progress progress-striped active"><div class="bar progress-bar progress-bar-striped active" style="width: '+s+'%;">'+s+"%</div><div>"),s>=100&&(jQuery(".progressbar").addClass("hide"),Joomla.renderMessages({success:[a]}))},courseMediaCount:function(e){jQuery.ajax({url:tjlmsAdmin.fileCountUrl,type:"POST",data:{cid:e},success:function(a){var s=JSON.parse(a);e&&s.data>0?(jQuery("#file_count").show().html(Joomla.JText._("COM_TJLMS_CALCULATE_COURSE_PDF_FILE_COUNT").replace("%s",s.data)),jQuery("#changeViewer").removeClass("inactiveLink"),jQuery("#changeViewer").removeClass("disabled")):(jQuery("#file_count").hide(),jQuery("#changeViewer").addClass("inactiveLink"),jQuery("#changeViewer").addClass("disabled"))}})}}};tjlmsAdmin.initialize();