var tjlmsAdmin={calculateCourseUrl:"index.php?option=com_tjlms&view=tools&task=tools.calculateCourseProgress&format=json",showEnrolledUsersUrl:"index.php?option=com_tjlms&task=course.enrolledUsersCount&format=json",validateDates:function(e){var s=jQuery(e).find('input[name="jform[start_date]"]'),e=jQuery(e).find('input[name="jform[end_date]"]'),s=s.val(),a=e.val();if(""!=s){if(null==s.split(" ")[0].match(/^\d{4}[-](0?[1-9]|1[012])[-](0?[1-9]|[12][0-9]|3[01])$/))return Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_INVALID_START_DATE")]}),!1}else if(""!=a)if(null==(a=a.split(" "))[0].match(/^\d{4}[-](0?[1-9]|1[012])[-](0?[1-9]|[12][0-9]|3[01])$/))return Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_INVALID_END_DATE")]}),!1;return!(""!=a&&a<s&&(jQuery(e).focus(),Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_DATE_RANGE_VALIDATION")]}),1))},eachform:{$form:null,saveurl:"",extraValidations:"",validate:function(){var o,e,s=document.formvalidator.isValid(document.getElementById(this.$form.attr("id"))),r=this.$form;return s&&this.extraValidations&&(o=!0,e=this.extraValidations.split(","),jQuery(e).each(function(e,s){var a=window,t=s.split(".");for(i=0;i<t.length;i++)a=a[t[i]];if(!(o=a(r)))return!1}),o||(s=!1)),s},ajaxsave:function(){var s,e,a,t=this.validate();return t&&(this.saveurl||(this.saveurl=jQuery(this.$form).attr("action")),this.saveurl=Joomla.getOptions("system.paths").base+"/"+this.saveurl,s=this.$form,e={},"multipart/form-data"==jQuery(s).attr("enctype")?(a=new FormData(s[0]),e.contentType=!1,e.processData=!1):a=s.serialize(),tjService.postData(this.saveurl,a,e).fail(function(e){t=!1}).done(function(e){!e.success&&e.message&&(Joomla.renderMessages({error:[e.message]}),t=!1),e.messages&&Joomla.renderMessages(e.messages),"multipart/form-data"==jQuery(s).attr("enctype")&&jQuery(s).find("input[type='file']").val(""),t=e.data})),t}},stepform:{ajaxSaveTabs:!0,ifintmpl:!0,init:function(){ifintmpl=this.ifintmpl;var s=this;jQuery(document).ready(function(){ifintmpl&&jQuery('a[data-bs-toggle="tab"]').on("shown.bs.tab",function(e){s.formactions()}),s.formactions()}),jQuery(window).on("load",function(){jQuery(".nav-tabs li").click(function(){var e=jQuery(this).index();if(!s.validateTabs(e))return!1}),jQuery("[data-js-attr='form-actions-next']").click(function(){jQuery(".nav-tabs li a.nav-link.active").closest("li").next("li").find(".nav-link")[0].click(),jQuery("html, body").animate({scrollTop:0},500),jQuery(".nav-tabs li a.nav-link.active").closest("li").is(":last-child")&&(jQuery("#toolbar-prev button","[data-js-attr='form-actions']").show().removeClass("d-none"),jQuery("#toolbar-next button","[data-js-attr='form-actions']").hide().addClass("d-none"),jQuery("#toolbar-save button","[data-js-attr='form-actions']").show().removeClass("d-none"))}),jQuery("[data-js-attr='form-actions-prev']").click(function(){jQuery(".nav-tabs li a.nav-link.active").closest("li").prev("li").find(".nav-link")[0].click()})})},formactions:function(){jQuery("#toolbar-prev button, #toolbar-next button, #toolbar-apply button, #toolbar-save button","[data-js-attr='form-actions']").hide(),(jQuery(".nav-tabs li a.nav-link.active").closest("li").is(":first-child")?(jQuery("#toolbar-prev button","[data-js-attr='form-actions']").hide().addClass("d-none"),jQuery("#toolbar-next button","[data-js-attr='form-actions']")):jQuery(".nav-tabs li a.nav-link.active").closest("li").is(":last-child")?(jQuery("#toolbar-prev button","[data-js-attr='form-actions']").show().removeClass("d-none"),jQuery("#toolbar-next button","[data-js-attr='form-actions']").hide().addClass("d-none"),jQuery("#toolbar-save button","[data-js-attr='form-actions']")):(jQuery("#toolbar-prev button","[data-js-attr='form-actions']").show().removeClass("d-none"),jQuery("#toolbar-next button","[data-js-attr='form-actions']"))).show().removeClass("d-none"),jQuery("[data-js-id='item-id']").val()&&jQuery("#toolbar-save","[data-js-attr='form-actions']").show()},validateTabs:function(e){for(var s=!0,a=tjlmsAdmin.eachform,t=0;t<e;t++){var o,r=jQuery(".nav-tabs li").get(t),r=jQuery("a",jQuery(r)).attr("href");if(a.extraValidations=jQuery(".extra_validations",jQuery(r)).attr("data-js-validation-functions"),!(s=this.ajaxSaveTabs?(a.$form=jQuery("form",r),o=jQuery("form [name='task']",r).val(),i=jQuery("form [name='option']",r).val(),a.saveurl="index.php?option="+i+"&task="+o+"&format=json",a.ajaxsave()):(a.$form=jQuery(r),a.validate())))break;this.ajaxSaveTabs&&jQuery.each(s,function(e,s){jQuery("[data-js-id='"+e+"']").val(s)});var i=jQuery(a.$form).attr("id");window.tjlmsAdmin[i]&&window.tjlmsAdmin[i].afterSave&&window.tjlmsAdmin[i].afterSave(s)}return s}},modules:{init:function(){var t=this;jQuery(window).on("load",function(){jQuery(".tjlms_module__changestate, .tjlms_module__edit, .tjlms_module__delete").show(),jQuery(".tjlms_lesson__edit, .tjlms_lesson__delete").show(),jQuery(".content-li").click(function(){var e=jQuery(this).closest("li").attr("id").replace("modlist_","");jQuery("#curriculum-lesson-ul_"+e).toggle()}),jQuery(document).on("click","[data-js-id='course-module'] [data-js-id='change-module-state']",function(){var e=jQuery(this).closest("[data-js-id='course-module']"),s=jQuery(e).attr("data-js-itemid"),e=jQuery(e).find('[data-js-id="module-state"]').val(),e=1===parseInt(e)?0:1;t.changeModuleState(s,e)}),jQuery(document).on("click","[data-js-id='edit-module']",function(){var e=jQuery(this).closest("[data-js-id='course-module']").attr("data-js-itemid");t.toggleForm(e,"show")}),jQuery(document).on("click","[data-js-id='delete-module']",function(){var e=jQuery(this).closest("[data-js-id='course-module']");if(0<jQuery(e).find('[data-js-id="module-lesson"]').length)return alert(Joomla.JText._("COM_TJLMS_MODUELS_MODULE_WITH_LESSONS_DELETE_ERROR")),!1;e=jQuery(e).attr("data-js-itemid");t.deleteModule(e)}),jQuery(document).on("click","[data-js-id='delete-lesson']",function(){var e=jQuery(this).closest("[data-js-id='module-lesson']").attr("data-js-itemid"),s=jQuery(this).closest("[data-js-id='course-module']").attr("data-js-itemid"),a=jQuery("#course_id").val();t.deleteLesson(e,s,a)}),t.updateModules(),t.sort()})},sort:function(){jQuery("[data-js-id='lessons_container']").sortable({scroll:!1,connectWith:"[data-js-id='lessons_container']",handle:".lessonSortingHandler",items:"> li:not(.non-sortable-lesson-li)",update:function(){var e=jQuery("#course_id",jQuery(this).closest(".curriculum-container")).val(),s=jQuery(this).closest("[data-js-id='course-module']"),a=jQuery(s).attr("data-js-itemid"),t=[];jQuery(s).find('[data-js-id="module-lesson"]').each(function(e){t[e]=jQuery(this).attr("data-js-itemid"),e++});tjService.postData("index.php?option=com_tjlms&task=modules.sortModuleLessons&format=json",{courseId:e,moduleId:a,lessons:t}).fail(function(e){Joomla.renderMessages({error:[e]})}).done(function(e){!e.success&&e.message&&Joomla.renderMessages({error:[e.message]}),tjlmsAdmin.modules.updateModules()})}}),jQuery(".courseModules").sortable({handle:".moduleSortingHandler",update:function(){var e=jQuery("#course_id",jQuery(this).closest(".curriculum-container")).val(),s=[];jQuery("[data-js-id='course-module']").each(function(e){s[e]=jQuery(this).attr("data-js-itemid"),e++});tjService.postData("index.php?option=com_tjlms&task=modules.sortModules&format=json",{courseId:e,modules:s}).fail(function(e){Joomla.renderMessages({error:[e]})}).done(function(e){!e.success&&e.message&&Joomla.renderMessages({error:[e.message]})})}})},updateModules:function(){jQuery('[data-js-id="course-module"]',window.parent.document).each(function(){var e=jQuery(this).find('[data-js-id="module-lesson"]').length;jQuery(this).find(".tjlms_module__delete").hide(),0==e&&jQuery(this).find(".tjlms_module__delete").show()})},changeModuleState:function(t,o,e){tjService.postData("index.php?option=com_tjlms&task=modules.changeState&format=json",{mod_id:t,state:o}).fail(function(e){Joomla.renderMessages({error:[e]})}).done(function(e){!e.success&&e.message&&(s={error:[e.message]},Joomla.renderMessages(s)),e.message&&(s={success:[e.message]},Joomla.renderMessages(s));var s=o?"publish":"unpublish",a=o?"modPublish":"modUnpublish";e.data.state;jQuery("#modlist_"+t+" .tjlms_module").removeClass("modUnpublish").removeClass("modPublish").addClass(a),jQuery("#modlist_"+t+" .tjlms_module .tjlms_module__changestate i").removeClass("icon-publish").removeClass("icon-unpublish").addClass("icon-"+s),jQuery("#modlist_"+t+' .tjlms_module [data-js-id="module-state"]').val(o)})},deleteModule:function(a){var e;return 1==confirm(Joomla.JText._("COM_TJLMS_SURE_DELETE_MODULE"))&&((e={})[jQuery('[data-js-id="form-token"]').attr("name")]=1,e.moduleId=a,tjService.postData("index.php?option=com_tjlms&task=modules.deleteModule&format=json",e).fail(function(e){Joomla.renderMessages({error:[e]})}).done(function(e){var s;!e.success&&e.message&&(s={error:[e.message]},Joomla.renderMessages(s)),e.success&&(s={success:[e.message]},Joomla.renderMessages(s),jQuery("[data-js-id='course-module'][data-js-itemid='"+a+"']").remove())})),!1},editModule:function(a){var e=new FormData,s=jQuery("#module-image"+a)[0].files[0],t=jQuery("#course_id").val(),o=jQuery("#module-description"+a).val(),r=jQuery("#module-title"+a).val(),i=jQuery("#state"+a).val();e.append("jform[image]",s),e.append("tjlms_module[id]",a),e.append("tjlms_module[description]",o),e.append("tjlms_module[name]",r),e.append("tjlms_module[course_id]",t),e.append("tjlms_module[state]",i),params={contentType:!1,processData:!1},url="index.php?option=com_tjlms&task=modules.saveModule&format=json",tjService.postData(url,e,params).fail(function(e){e={error:[e.message]};Joomla.renderMessages(e)}).done(function(e){0==a&&location.reload(!0);var s=jQuery("#tjlms_module_form_"+a).find(".module-title").val();jQuery("[data-js-id='course-module'][data-js-itemid='"+a+"']").find(".tjlms_module_title").text(s),jQuery("[data-js-id='course-module'][data-js-itemid='"+a+"']").find(".tjlms_module_thumbnail_image").val(e.data.image),e.data.imagePath&&(jQuery("[data-js-id='course-module'][data-js-itemid='"+a+"']").find(".tjlms_module_thumbail").removeClass("hide"),jQuery("[data-js-id='course-module'][data-js-itemid='"+a+"']").find(".tjlms_module_image_path").attr("src",e.data.imagePath)),tjlmsAdmin.modules.toggleForm(a,"hide"),jQuery("#module-image"+a).val(""),e.success?Joomla.renderMessages({success:[e.message]}):Joomla.renderMessages({error:[e.message]})})},sendModuleEmailNotification:function(s){var e,a,t,o=confirm(Joomla.JText._("COM_TJLMS_SEND_EMAIL_NOTIFICATION_ON_MODULE_CONFERMATION"));1==o&&(e=new FormData,a=jQuery("#course_id").val(),t=jQuery("#module-title"+s).val(),e.append("tjlms_module[id]",s),e.append("tjlms_module[name]",t),e.append("tjlms_module[course_id]",a),e.append("tjlms_module[comfirmSendNotification]",o),params={contentType:!1,processData:!1},url="index.php?option=com_tjlms&task=modules.sendModuleEmailNotification&format=json",tjService.postData(url,e,params).fail(function(e){e={error:[e.message]};Joomla.renderMessages(e)}).done(function(e){0==s&&location.reload(!0),tjlmsAdmin.modules.toggleForm(s,"hide"),e.success?Joomla.renderMessages({success:[e.message]}):Joomla.renderMessages({error:[e.message]})}))},toggleModuleAdditionalInfo:function(e){!0===(e=0===e?jQuery("[data-js-id='create-module-form']"):jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']")).find(".tjlms_module_image_desc").is(":hidden")?e.find(".toggleModuleButton").html("<a>"+Joomla.JText._("COM_TJLMS_ADDITIONAL_DETAILS_HIDE")+"</a>"):e.find(".toggleModuleButton").html("<a>"+Joomla.JText._("COM_TJLMS_ADDITIONAL_DETAILS")+"</a>"),e.find(".tjlms_module_image_desc").toggle("open")},deleteMedia:function(s){if(!confirm(Joomla.JText._("JGLOBAL_CONFIRM_DELETE")))return!1;data={moduleId:s},url="index.php?option=com_tjlms&task=modules.deleteImage&format=json",tjService.postData(url,data).fail(function(e){Joomla.renderMessages({error:[e]})}).done(function(e){jQuery("[data-js-id='course-module'][data-js-itemid='"+s+"']").find(".tjlms_module_thumbnail_image").val(""),jQuery("[data-js-id='course-module'][data-js-itemid='"+s+"']").find(".tjlms_module_thumbail").addClass("hide"),jQuery("[data-js-id='course-module'][data-js-itemid='"+s+"']").find(".tjlms_module_image_path").attr("src",""),e.success?Joomla.renderMessages({success:[e.message]}):Joomla.renderMessages({error:[e.message]})})},toggleForm:function(e,s="show"){e=jQuery("[data-js-id='course-module'][data-js-itemid='"+e+"']");return"show"==s?(e.length?(jQuery(e).find("[data-js-id='edit-module-form']").show(),jQuery(e).find("[data-js-id='edit-module-form'] .module-title")):(jQuery('[data-js-id="create-module-form"]').show(),jQuery(".add-module-div").hide(),jQuery('[data-js-id="create-module-form"] .module-title'))).focus():e.length?jQuery(e).find("[data-js-id='edit-module-form']").hide():(jQuery('[data-js-id="create-module-form"]').hide(),jQuery(".add-module-div").show()),!1},deleteLesson:function(a,e,s){var t;return 1==confirm(Joomla.JText._("COM_TJLMS_SURE_DELETE"))&&((t={})[jQuery('[data-js-id="form-token"]').attr("name")]=1,t.lessonId=a,t.moduleId=e,t.courseId=s,tjService.postData("index.php?option=com_tjlms&task=modules.deleteLesson&format=json",t).fail(function(e){Joomla.renderMessages({error:[e]})}).done(function(e){var s;!e.success&&e.message&&(s={error:[e.message]},Joomla.renderMessages(s)),e.success&&(s={success:[e.message]},Joomla.renderMessages(s),jQuery("#lessonlist_"+a).remove())})),!1}},lesson:{init:function(e,s,o,a,t){jQuery("input[type='file'][data-upload-ajax='1']").change(function(){thisfile=jQuery(this);var e=jQuery(thisfile)[0].files[0],s=new FormData,e=(s.append("FileInput",e),jQuery('[data-js-id="id"]').val()),a=jQuery('[data-js-id="format"]').val(),t=jQuery('[data-js-id="subformat"]').val();s.append("mediaformat",a),s.append("subformat",t),s.append("formatData["+a+"]["+t+"][lessonId]",e),tjLmsCommon.file.$file=thisfile,tjLmsCommon.file.formData=s,tjLmsCommon.file.allowedSize=o,tjLmsCommon.file.showstatusbar=!0,tjLmsCommon.file.afterProcessDone="tjlmsAdmin.lessonFormatForm.populateMediaId",tjLmsCommon.file.upload()}),jQuery(document).ready(function(){0<t&&(jQuery("#assessmentform .subform-repeatable").addClass("disabled").css("pointer-events","none"),jQuery("[data-js-id='disable-if-reviewed']").addClass("disabled").css("pointer-events","none"))}),Joomla.submitbutton=function(e){if("lesson.save"==e){e=jQuery(".tjlms_add_lesson_form .nav-tabs li").length;if(!tjlmsAdmin.stepform.validateTabs(e))return!1}window.location=a}},preview:function(e="addModal",s=null){jQuery("#"+e+s).modal("show")},selectionPopup:function(){jQuery("#lessonTypeModal").modal("show")},addToCourse:function(e,s,a){var t={},e=(t[jQuery('[data-js-id="form-token"]').attr("name")]=1,t.lessonId=e,t.courseId=s,t.modId=a,tjService.postData("index.php?option=com_tjlms&task=lesson.addLessonTocourse&format=json",t));e.fail(function(e){Joomla.renderMessages({error:[e]}),0}).done(function(e){!e.success&&e.message&&(Joomla.renderMessages({error:[e.message]}),0),e.success&&(window.parent.location.href=e.data.redirect_url)})}},basicForm:{validate:function(e){var s=jQuery(e).find("[name$='[no_of_attempts]']"),a=jQuery(e).find("[name$='[no_of_attempts]']").val(),t=jQuery(e).find("#no_attempts").val(),e=jQuery(e).find("#max_attempt").val();return isNaN(a)&&jQuery(s).val(0),!(0!=a&&a<e&&(a=Joomla.JText._("COM_TJLMS_MAX_ATTEMPT_VALIDATION_MSG").replace("%s",e),Joomla.renderMessages({error:[a]}),jQuery(s).val(t).focus(),1))}},lessonFormatForm:{$form:null,initForm:function(){return this.$form=jQuery(".lesson-format-form")},showSubformat:function(e,s){jQuery(this.$form).find(".subformat").hide().addClass("d-none"),jQuery(this.$form).find("."+e+"_subformat[data-subformat='"+s+"']").show().removeClass("d-none")},validate:function(formElement){var format=jQuery(formElement).find("[name$='[format]']").val(),subformat=jQuery(formElement).find("[name$='[subformat]']").val(),media_id=jQuery(formElement).find("[name$='[media_id]']").val(),formId=jQuery(formElement).find("[name$='[form_id]']").val(),function_to_call="validate"+format+subformat,check_validation=eval(function_to_call)(formId,format,subformat,media_id);return"0"==check_validation.check?(Joomla.renderMessages({error:[check_validation.message]}),!1):!0},populateMediaId:function(e){jQuery("[data-js-id='media_id']").val(e.media_id)}},associateFileForm:{$form:null,initForm:function(){return this.$form=jQuery(".lesson-format-form")},init:function(){jQuery("[data-js-type='associate_file_upload'] input[type='file']").change(function(){thisfile=jQuery(this);var e=jQuery(thisfile)[0].files[0],s=new FormData,e=(s.append("FileInput",e),jQuery('[data-js-id="id"]').val());s.append("mediaformat","associate"),s.append("subformat","upload"),s.append("formatData[associate][upload][lessonId]",e),tjLmsCommon.file.$file=thisfile,tjLmsCommon.file.formData=s,parseFloat(thisfile.attr("data-allowedsize"))&&(tjLmsCommon.file.allowedSize=parseFloat(thisfile.attr("data-allowedsize"))),tjLmsCommon.file.showstatusbar=!0,tjLmsCommon.file.afterProcessDone="tjlmsAdmin.associateFileForm.showFileinAssociatelist",tjLmsCommon.file.upload()}),jQuery(document).on("click","[data-js-id='associated-file-remove']",function(){var e=jQuery(this).attr("data-js-val"),s=jQuery(this).closest(".lesson-associatefile-form").find("[data-js-id='id']").val();tjlmsAdmin.associateFileForm.removeFile(s,e)})},showFileinAssociatelist:function(e){var s=jQuery("[data-js-id='id']").val(),a=jQuery(".lesson-associatefile-form"),s='<tr id="assocfiletr_'+e.media_id+'"><td class="tjlmscenter" id="list_select_files'+e.media_id+'"><span>'+e.org_filename+'</span><input type="hidden" name="lesson_files[][media_id]" value="'+e.media_id+'"/></td><td class="tjlmscenter"><i id="removeFile'+e.media_id+'" onclick="tjlmsAdmin.associateFileForm.removeFile(\''+s+"', '"+e.media_id+'\')" class="remove btn">×</i></td></tr>';jQuery(a).find(".no_selected_files").hide(),jQuery(a).find("#list_selected_files").append(s),jQuery(a).find("#list_selected_files").show()},batchSelect:function(t){var o=jQuery("input[id*='cb']:checked").length;if(0==o)return alert(Joomla.JText._("COM_TJLMS_ASSOCIATE_MESSAGE_SELECT_ITEMS")),!1;window.parent.jQuery('.lesson-associatefile-form[data-js-unique="'+t+'"] .no_selected_files').hide(),window.parent.jQuery("#lesson-associatefile-form_"+t+" #list_selected_files").show();var r=window.parent.jQuery('.lesson-associatefile-form[data-js-unique="'+t+'"]').find("[data-js-id='id']").val(),i=1;jQuery("input[id*='cb']:checked").each(function(){var s=jQuery(this).val(),a=jQuery(this).closest(".associtefile").find(".associtefile__name").text(),e=Joomla.getOptions("system.paths").root+"/index.php?option=com_tjlms&task=lessonform.addMediaAsAssociatetoLesson&format=json",e=tjService.postData(e,{mediaId:s,lessonId:r});e.fail(function(e){Joomla.renderMessages({error:[e]}),0}).done(function(e){!e.success&&e.message&&(Joomla.renderMessages({error:[e.message]}),0),e.messages&&Joomla.renderMessages(e.messages);e='<tr id="assocfiletr_'+s+'" data-js-id="associated-file"><td class="tjlmscenter" id="list_select_files'+s+'"><span>'+a+'</span><input type="hidden" name="lesson_files[][media_id]" value="'+s+'"/></td><td class="tjlmscenter"><i data-js-id="associated-file-remove" data-js-val="'+s+'" class="remove btn">×</i></td></tr>';jQuery("#lesson-associatefile-form_"+t+" #list_selected_files",parent.document).append(e),i==o&&window.parent.Joomla.Modal.getCurrent().close(),i++})})},removeFile:function(e,a){var s;1==confirm(Joomla.JText._("COM_TJLMS_REMOVE_ASSOCIATE_FILE_MESSAGE"))&&(s=Joomla.getOptions("system.paths").root+"/index.php?option=com_tjlms&task=lessonform.removeAssociatedFileFromLesson&format=json",s=tjService.postData(s,{mediaId:a,lessonId:e}),s.fail(function(e){Joomla.renderMessages({error:[e]}),0}).done(function(e){var s;!e.success&&e.message&&(s={error:[e.message]},Joomla.renderMessages(s),0),e.message&&(s={success:[e.message]},Joomla.renderMessages(s),jQuery("#assocfiletr_"+a).remove())}))}},assessmentform:{$form:null,init:function(){jQuery(document).on("subform-row-add",function(e,s){jQuery(s).find(".param_value").attr("onBlur","tjlmsAdmin.assessmentform.calculateTotal()"),jQuery(s).find(".param_weightage").attr("onBlur","tjlmsAdmin.assessmentform.calculateTotal()")}),jQuery(".param_weightage, .param_value").blur(function(){tjlmsAdmin.assessmentform.calculateTotal()}),jQuery("[name='jform[add_assessment]']").click(function(){1==jQuery(this).val()?(jQuery("[data-js-id='assessment-details']").show().removeClass("hide"),jQuery(".assessment-param-required").addClass("required").attr("required","required")):(jQuery("[data-js-id='assessment-details']").hide().addClass("hide"),jQuery(".assessment-param-required").removeClass("required").removeAttr("required"))}),jQuery("[data-js-id='assessment-details']").hide().addClass("hide"),jQuery(".assessment-param-required").removeClass("required").removeAttr("required"),1==jQuery("[name='jform[add_assessment]']:checked").val()&&(jQuery("[data-js-id='assessment-details']").show().removeClass("hide"),jQuery(".assessment-param-required").addClass("required").attr("required","required")),jQuery("[name='jform[assessment_answersheet]']").click(function(){1==jQuery(this).val()?jQuery("[data-js-id='answersheet_options']").show().removeClass("hide"):jQuery("[data-js-id='answersheet_options']").hide().addClass("hide")}),jQuery("[data-js-id='answersheet_options']").hide().addClass("hide"),1==jQuery("[name='jform[assessment_answersheet]']:checked").val()&&jQuery("[data-js-id='answersheet_options']").show().removeClass("hide")},initForm:function(){return this.$form=jQuery("#assessmentform")},calculateTotal:function(){var e=0,s=this.$form;jQuery(".subform-repeatable-group",s).each(function(){e+=jQuery(".param_value",this).val()*jQuery(".param_weightage",this).val()}),jQuery("#jform_total_marks",s).val(e)},validate:function(e){if(1==jQuery(e).find("[name='jform[add_assessment]']:checked").val()){if(0==jQuery(".subform-repeatable-group",e).length)return Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_ASSESSMENT_MSG_NO_PARAMS")]}),!1;tjlmsAdmin.assessmentform.calculateTotal();var s=parseInt(jQuery("#jform_total_marks",e).val()),a=parseInt(jQuery("#jform_passing_marks",e).val());if(isNaN(a)||a<=0||s<a)return jQuery("input[name='jform[passing_marks]']",e).val(""),jQuery("input[name='jform[passing_marks]']",e).focus(),Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_ASSESSMENT_MARKS_MISMATCH")]}),!1;var s=jQuery(e).find("[name$='[assessment_attempts]']"),a=jQuery(e).find("[name$='[assessment_attempts]']").val(),t=jQuery(e).find("#no_assessment").val(),o=jQuery(e).find("#max_assessment").val();if(isNaN(a)&&jQuery(s).val(0),0!==a&&a<o)return a=Joomla.JText._("COM_TJLMS_MIN_NO_OF_ASSESSMENT_VALIDATION_MSG").replace("%s",o),Joomla.renderMessages({error:[a]}),jQuery(s).val(t).focus(),!1}else jQuery("input[name='jform[passing_marks]']",e).val(""),jQuery("input[name='jform[total_marks]']",e).val("");return!0}},initialize:function(){var s=this;return jQuery(window).on("load",function(){var e;s.lessonFormatForm.initForm().length&&(e=jQuery(s.lessonFormatForm.$form).find("input[name$='[format]']").val(),jQuery(".subformat").hide().addClass("d-none"),jQuery("."+e+"_subformat[data-subformat='"+jQuery("[name$='[subformat]']").val()+"']").show().removeClass("d-none"),jQuery("[name$='[subformat]']").change(function(){s.lessonFormatForm.showSubformat(e,jQuery(this).val())})),s.associateFileForm.initForm().length&&s.associateFileForm.init(),s.assessmentform.initForm().length&&s.assessmentform.init()}),this},certificateTemplate:{editor:"",usedCertCount:"",init:function(){var e=this.usedCertCount;jQuery(document).ready(function(){jQuery("#jformcertificatetemplate").change(function(e){tjlmsAdmin.certificateTemplate.loadTemplate()}),0<e&&(jQuery("#jform_access0").attr("disabled",!0),jQuery("#jform_access").parent(".controls").append("<div class='alert alert-info'>"+Joomla.JText._("COM_TJLMS_CERTIFICATE_ACCESS_MSG")+"</div>")),Joomla.submitbutton=function(e){("certificatetemplate.cancel"==e||"certificatetemplate.cancel"!=e&&document.formvalidator.isValid(document.id("certificatetemplate-form")))&&Joomla.submitform(e,document.getElementById("certificatetemplate-form"))}})},loadTemplate:function(){var e=Joomla.getOptions("system.paths").base+"/index.php?option=com_tjlms&task=certificatetemplate.loadtemplate",s={id:jQuery("#jformcertificatetemplate").val()};tjService.postData(e,s).fail(function(e){e={error:[e.responseText]};Joomla.renderMessages(e)}).done(function(e){!e.success&&e.message?Joomla.renderMessages({error:[e.message]}):(("tinymce"==this.editor||"jce"==this.editor?jQuery("iframe").contents().find("body#tinymce"):jQuery("iframe").contents().find("body")).html(e.data.body),jQuery("#jform_body").val(e.data.body),jQuery("#jform_template_css").val(e.data.template_css),"tinymce"!=this.editor&&"jce"!=this.editor||(tinyMCE.execCommand("mceToggleEditor",!1,"response.data.body"),tinyMCE.execCommand("mceToggleEditor",!1,"response.data.body")))})}},tools:{startLimit:0,init:function(){jQuery(window).on("load",function(){var e=jQuery("#filter_course_names").val();e&&tjlmsAdmin.tools.showEnrolledUsers(e)})},calculateCourseProgress:function(e,s){var a=jQuery("#filter_course_names").val();e&&s?(e=Joomla.JText._("COM_TJLMS_TOOLS_COMPLETED_SUCCESSFULLY"),tjlmsAdmin.tools.uploadProgressBar(s,e)):tjlmsAdmin.tools.startLimit=0,tjlmsAdmin.tools.sendAjaxRequest(tjlmsAdmin.calculateCourseUrl,a,tjlmsAdmin.tools.startLimit)},sendAjaxRequest:function(e,s,a){jQuery.ajax({url:e,data:{courseId:s,batchsize:batchsize,startLimit:a},type:"POST",success:function(e){var e=JSON.parse(e),s=e.data;e.success?s.flag&&tjlmsAdmin.tools.calculateCourseProgress(s.flag,s.totalEnrolledUsers):Joomla.renderMessages({error:[e.message]})},error:function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_TJLMS_CALCULATE_COURSE_PROGRESS_FAILURE")]})}})},showEnrolledUsers:function(s){jQuery.ajax({url:tjlmsAdmin.showEnrolledUsersUrl,type:"POST",data:{cid:s},success:function(e){e=JSON.parse(e);s&&0<e.data?(jQuery("#enrolled_user_notice").show().html(Joomla.JText._("COM_TJLMS_CALCULATE_COURSE_TRACK_ENROLLED_USER_COUNT").replace("%s",e.data)),jQuery("#recalculate").removeClass("inactiveLink"),jQuery("#recalculate").removeClass("disabled")):(jQuery("#enrolled_user_notice").hide(),jQuery("#recalculate").addClass("inactiveLink"),jQuery("#recalculate").addClass("disabled"))}})},uploadProgressBar:function(e,s){jQuery(".progressbar").removeClass("hide"),tjlmsAdmin.tools.startLimit=parseInt(tjlmsAdmin.tools.startLimit)+parseInt(batchsize);var a=Math.round(100*tjlmsAdmin.tools.startLimit/e);batchsize>e&&(a=100),jQuery(".progressbar").html('<div class="center alert alert-info"><strong>'+Joomla.JText._("COM_TJLMS_TOOLS_PROGRESS_MESSAGE")+'</strong></div><div class="progress progress-striped active"><div class="bar progress-bar progress-bar-striped active" style="width: '+a+'%;">'+a+"%</div><div>"),100<=a&&(jQuery(".progressbar").addClass("hide"),Joomla.renderMessages({success:[s]}))}},dashboard:{downloadArabicLib:function(){jQuery.ajax({url:"index.php?option=com_tjlms&task=dashboard.downloadArabicLib&tmpl=component",type:"POST",dataType:"json",async:!1,beforeSend:function(){document.body.appendChild(document.createElement("joomla-core-loader"))},success:function(e){1==e.data?Joomla.renderMessages({success:[e.message]}):Joomla.renderMessages({error:[e.message]}),document.body.removeChild(document.querySelector("joomla-core-loader"))}})}}};tjlmsAdmin.initialize();