jQuery(function(e){if(Vue.component("vue-switch",{props:["plugin","ischecked"],data:function(){return{id:"vue-switch_",loading:!1,disabled:!1}},mounted:function(){this.id+=this.plugin.id},methods:{toggleActive(i){if(this.loading)return!0;this.loading=!0,this.disabled=!0;let l=ACYM_AJAX_URL+"&ctrl=plugins&task=toggleActivate&id="+i;e.get(l,e=>{if((e=acym_helper.parseJson(e)).error)return acym_helperNotification.addNotification(e.message,"error"),!1;this.loading=!1,this.disabled=!1})}},template:'<div class="cell shrink grid-x"><div class="switch cell shrink"> <input class="switch-input" :id="id" type="checkbox" name="exampleSwitch" :checked="ischecked"> <label class="switch-paddle" @click="toggleActive(plugin.id)" :for="id"> </label> </div><i v-show="loading" class="cell shrink acym__card__loader acymicon-circle-o-notch acymicon-spin"></i></div>'}),e("#acym__plugin__installed__application").length>0){const i=(e,i)=>e.filter(e=>e.id!==i);new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__plugin__installed__application",data:{allPlugins:[],displayedPlugins:[],search:acym_helper.getCookie("acym_installed_plugins_search"),type:acym_helper.getCookie("acym_installed_plugins_type"),level:acym_helper.getCookie("acym_installed_plugins_level"),loading:!0,noPluginTodisplay:!1,typingTimer:"",doneTypingInterval:1e3,currentLevel:"",downloading:{},pluginToggling:{},updating:{},pageDisplay:1,busy:!1,showSettings:{}},mounted:function(){acym_helper.config_get("level").done(e=>{if(e.error)return acym_helperNotification.addNotification(e.message,"error"),!1;this.allPlugins=acym_helper.parseJson(document.getElementById("acym__plugins__all").value),document.getElementById("acym__plugins__all").remove(),this.currentLevel=e.data.value.toLowerCase(),this.resetDisplay(),0===this.displayedPlugins.length&&(this.noPluginTodisplay=!0),this.fillPluginToggling(),this.fillUpdating(),acym_helper.setSubmitButtonGlobal(),this.loading=!1,setTimeout(()=>{this.$forceUpdate(),this.afterRender()},100)})},methods:{afterRender(){e(document).foundation(),e(".reveal-overlay").appendTo("#acym_form"),e(document).trigger("acym_plugins_installed_loaded"),acym_helperTooltip.setTooltip(),acym_helper.setSubmitButtonGlobal(),acym_helperRadio.setRadioIconsGlobal(),acym_helperSwitch.setSwitchFieldsGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperSelect2.setSelect2(),acym_helperInput.setMulticouple()},toggleSettings(i){let l=e("#acym__plugins__card__"+i),t=e(".acym__plugins__card__flip");!l.hasClass("acym__plugins__card__flip")&&t.length>0&&this.flipCard(t),this.flipCard(l),e('[name="plugin__folder_name"]').val(l.hasClass("acym__plugins__card__flip")?i:"")},flipCard(e){e.toggleClass("acym__plugins__card__flip"),setTimeout(()=>{e.toggleClass("acym__plugins__card__flipped"),acym_helperTooltip.setTooltip()},110)},updatePlugin(i){if(this.updating[i.id])return!0;this.updating[i.id]=!0,this.updating={...this.updating};let l=ACYM_AJAX_URL+"&ctrl=plugins&task=update";e.ajax({url:l,type:"POST",data:{plugin:i}}).then(e=>{if((e=acym_helper.parseJson(e)).error)return acym_helperNotification.addNotification(e.message,"error"),this.updating[i.id]=!1,this.updating={...this.updating},!1;acym_helperNotification.addNotification(e.message,"info"),this.updating[i.id]=!1,this.updating={...this.updating},this.toggleUptodateCurrentApp(i.id)})},removeOnePluginInApp(e){this.allPlugins=i(this.allPlugins,e),this.displayedPlugins=i(this.displayedPlugins,e)},resetDisplay(){this.pageDisplay=1,this.fillDisplayPlugins()},fillDisplayPlugins(){this.displayedPlugins=this.filterPlugin().slice(0,18*this.pageDisplay),this.displayedPlugins=[...this.displayedPlugins]},rightLevel(e){return"starter"===e||("essential"===e&&-1!==["essential","enterprise"].indexOf(this.currentLevel)||"enterprise"===e&&"enterprise"===this.currentLevel)},filterPlugin(){return this.allPlugins.filter(e=>-1!==e.level.toLowerCase().indexOf(this.level.toLowerCase())&&-1!==e.category.toLowerCase().indexOf(this.type.toLowerCase())&&-1!==e.folder_name.toLowerCase().indexOf(this.search.toLowerCase()))},toggleUptodateCurrentApp(e){this.allPlugins.map(i=>{i.id===e&&(i.uptodate="1"==i.uptodate?"0":"1")}),this.displayedPlugins=[...this.displayedPlugins]},deletePlugin(i){if(acym_helper.confirm(ACYM_JS_TXT.ACYM_ARE_YOU_SURE_DELETE_ADD_ON)){let l=ACYM_AJAX_URL+"&ctrl=plugins&task=deletePlugin&id="+i;e.get(l,e=>(e=acym_helper.parseJson(e)).error?(acym_helperNotification.addNotification(e.message,"error"),!1):(acym_helperNotification.addNotification(e.message,"info"),this.removeOnePluginInApp(i),!0))}},fillPluginToggling(){for(let e in this.allPlugins)this.pluginToggling[this.allPlugins[e].id]=!1},fillUpdating(){for(let e in this.allPlugins)this.updating[this.allPlugins[e].id]=!1},isActivated:e=>1==e?"checked":"",loadMorePlugins(){this.pageDisplay++,this.fillDisplayPlugins()},imageUrl:(e,i)=>"PLUGIN"===i?ACYM_MEDIA_URL+"images/plugins/"+e+".png":ACYM_CORE_DYNAMICS_URL+e+"/banner.png",documentationUrl(e,i){if(-1!==["article","page","post"].indexOf(e))return"https://docs.acymailing.com/addons/all-cms-add-ons/wordpress-posts-pages-and-joomla-articles";if("createuser"===e)return"https://docs.acymailing.com/addons/all-cms-add-ons/create-user";if("PLUGIN"!==i)return ACYM_UPDATEME_API_URL+"public/addons/documentation?file_name="+e;{const i=acym_helper.parseJson(ACYM_AVAILABLE_PLUGINS).find(i=>i.file_name===e);if(i)return i.documentation}},isOverflown(e){return void 0===this.$refs.plugins||void 0===this.$refs.plugins[e]?"":this.$refs.plugins[e].scrollHeight>this.$refs.plugins[e].clientHeight?"acym__plugins__card__params_desc__overflown":""}},watch:{displayedPlugins(e,i){this.noPluginTodisplay=0===this.displayedPlugins.length&&1!==i[0]},search(e){clearTimeout(this.typingTimer),document.cookie="acym_installed_plugins_search="+e+";",""===e?this.resetDisplay():this.typingTimer=setTimeout(()=>{this.resetDisplay()},this.doneTypingInterval)},type(){document.cookie="acym_installed_plugins_type="+this.type+";",this.resetDisplay()},level(){document.cookie="acym_installed_plugins_level="+this.level+";",this.resetDisplay()}}})}});